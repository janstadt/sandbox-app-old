!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("@fortawesome/free-solid-svg-icons"),require("rxjs"),require("@angular/router"),require("@angular/common"),require("@ng-bootstrap/ng-bootstrap"),require("@fortawesome/angular-fontawesome")):"function"==typeof define&&define.amd?define("@surescripts/notifications",["exports","@angular/core","@angular/common/http","rxjs/operators","@fortawesome/free-solid-svg-icons","rxjs","@angular/router","@angular/common","@ng-bootstrap/ng-bootstrap","@fortawesome/angular-fontawesome"],i):i(((t=t||self).surescripts=t.surescripts||{},t.surescripts.notifications={}),t.ng.core,t.ng.common.http,t.rxjs.operators,t["@fortawesome/free-solid-svg-icons"],t.rxjs,t.ng.router,t.ng.common,t["@ng-bootstrap/ng-bootstrap"],t["@fortawesome/angular-fontawesome"])}(this,function(t,i,e,o,n,r,s,a,c,l){"use strict";var u=function(){function t(){}return t.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=i.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),d=function(t){Object.assign(this,t),this.postedDate=new Date(t.postedDate);var i=(new Date).getTime()-this.postedDate.getTime();if(i<=36e5){var e=Math.round(i%864e5%36e5/6e4);this.readablePostedDate=e<2?"Moments ago":e+" minutes ago"}else if(i<=864e5){var o=Math.floor(i%864e5/36e5);this.readablePostedDate=o<2?o+" hour ago":o+" hours ago"}else if(i<=6048e5){var n=Math.floor(i/864e5);this.readablePostedDate=n<2?n+" day ago":n+" days ago"}},f=function(t){Object.assign(this,t),this.items=t.items.map(function(t){return new d(t)})},p={Read:"Read",Unread:"Unread"},m=function(){function t(t,i){this.http=t,this.router=i,this.faBell=n.faBell,this.unreadCount=0,this.SurescriptsNotificationStatus=p}return t.prototype.ngOnInit=function(){var t=this;if(!this.ssoBaseUrl)throw new Error('"ssoBaseUrl" is required.');this.ssoBaseUrl=this.ssoBaseUrl.replace(/\/+$/,"");var i=new r.BehaviorSubject(!1),e=r.interval(36e5).pipe(o.startWith(0),o.exhaustMap(function(){return t.poll()}));i.pipe(o.switchMap(function(t){return t?r.NEVER:e.pipe(o.materialize())}),o.dematerialize()).subscribe(),this.router.events.subscribe(function(e){e instanceof s.NavigationEnd&&(i.next(!0),t.poll().pipe(o.finalize(function(){i.next(!1)})).subscribe().unsubscribe())})},t.prototype.poll=function(){var t=this;return this.http.get(this.ssoBaseUrl+"/app/v1/user/notifications",{withCredentials:!0}).pipe(o.tap(function(i){t.notifications=new f(i),t.unreadCount=t.notifications.items.filter(function(t){return t.status===p.Unread}).length}))},t.prototype.itemClicked=function(t){var i=this;t.status===p.Unread&&this.http.put(this.ssoBaseUrl+"/app/v1/user/notifications/"+t.id+"/read",null,{withCredentials:!0}).pipe(o.tap(function(){t.status=p.Read,i.unreadCount=i.unreadCount-1})).subscribe()},t.prototype.dismiss=function(t,i){var e=this,n=this.notifications.items.indexOf(i);t.stopPropagation(),n>=0&&this.http.put(this.ssoBaseUrl+"/app/v1/user/notifications/"+i.id+"/dismiss",null,{withCredentials:!0}).pipe(o.tap(function(){e.notifications.items.splice(n,1),i.status===p.Unread&&(e.unreadCount=e.unreadCount-1)})).subscribe()},t.decorators=[{type:i.Component,args:[{selector:"surescripts-notifications",template:'<div class="d-inline-block" ngbDropdown [placement]="[\'bottom\', \'bottom-right\']" display="dynamic" autoClose="outside">\r\n    <a ngbDropdownToggle class="nav-link" id="surescripts-notifications-icon" [ngClass]="{\'new\': unreadCount > 0 }" title="{{unreadCount}} unread notifications" data-toggle="dropdown">\r\n        <fa-icon [icon]="faBell" [fixedWidth]="true" size="lg"></fa-icon>\r\n    </a>\r\n    <div ngbDropdownMenu>\r\n        <div class="card">\r\n            <div class="card-body">\r\n                <h5 class="card-title" id="notifications-title">Notifications ({{unreadCount}})</h5>\r\n            </div>\r\n            <ul class="list-group list-group-flush">\r\n                <li class="list-group-item flex-column align-items-start" *ngIf="notifications?.items?.length === 0">\r\n                    <span>No notifications at this time.</span>\r\n                </li>\r\n                <li class="list-group-item flex-column align-items-start" id="{{notification?.id}}" (click)="itemClicked(notification)" [ngClass]="{ \'read\': notification?.status === SurescriptsNotificationStatus.Read}" *ngFor="let notification of notifications?.items; index as j;">\r\n                    <h6 class="mb-1 text-truncate">\r\n                        <a href="{{notifications?.baseUrl}}/notifications/{{notification?.id}}"  id="{{notification?.id}}-notification-title" title="View All Notifications">{{notification.title}}</a>\r\n                    </h6>\r\n                    <p class="mb-1 text-truncate" title="{{notification.summary}}" id="{{notification?.id}}-notification-summary">{{notification.summary}}</p>\r\n                    <span class="d-flex w-100 justify-content-between">\r\n                        <small class="text-muted">{{notification.readablePostedDate || (notification.postedDate | date:\'shortDate\') }}</small>\r\n                        <small class="text-muted">\r\n                            <a href="javascript:void(0)" (click)="dismiss($event, notification)" id="{{notification?.id}}-notification-dismiss">Dismiss</a>\r\n                        </small>\r\n                    </span>\r\n                </li>\r\n            </ul>\r\n            <div class="card-footer text-center">\r\n                <a href="{{notifications?.baseUrl}}/notifications" id="view-all-notifications" title="View All Notifications">View All</a>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n</div>',styles:[".dropdown-toggle::after{display:none}.dropdown-toggle{cursor:pointer}#surescripts-notifications-icon.new{color:#f7901e}li{cursor:pointer;padding:.75rem}li.read{background-color:#f3f3f3}li h6>a,li span>small>a{color:inherit}.dropdown-menu{width:500px;max-height:400px;overflow-x:auto;padding:0}.dropdown-menu .card-title{margin-bottom:0}.dropdown-menu .card-body{padding:.75rem}.dropdown-menu .card-footer{border-top:none;background-color:#fff}"]}]}],t.ctorParameters=function(){return[{type:e.HttpClient},{type:s.Router}]},t.propDecorators={ssoBaseUrl:[{type:i.Input}]},t}(),g=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[a.CommonModule,e.HttpClientModule,c.NgbDropdownModule,l.FontAwesomeModule],declarations:[m],exports:[m]}]}],t}();t.NotificationsComponent=m,t.NotificationsModule=g,t.NotificationsService=u,t.SurescriptsNotification=d,t.SurescriptsNotificationStatus=p,t.SurescriptsNotifications=f,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=surescripts-notifications.umd.min.js.map